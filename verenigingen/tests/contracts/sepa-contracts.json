{
  "sepa_mandate_apis": {
    "create_sepa_mandate": {
      "request": {
        "type": "object",
        "required": ["member", "iban", "bic"],
        "properties": {
          "member": {
            "type": "string",
            "pattern": "^(Assoc-)?Member-\\d{4}-\\d{2}-\\d{4}$",
            "description": "Member ID in Frappe format"
          },
          "iban": {
            "type": "string",
            "pattern": "^[A-Z]{2}[0-9]{2}[A-Z0-9]+$",
            "minLength": 15,
            "maxLength": 34,
            "description": "International Bank Account Number"
          },
          "bic": {
            "type": "string",
            "pattern": "^[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?$",
            "description": "Bank Identifier Code (SWIFT)"
          },
          "mandate_type": {
            "type": "string",
            "enum": ["CORE", "B2B", "FIRST", "RCUR"],
            "default": "RCUR",
            "description": "SEPA mandate type"
          },
          "creditor_id": {
            "type": "string",
            "pattern": "^[A-Z]{2}[0-9]{2}[A-Z0-9]+$",
            "description": "SEPA Creditor Identifier"
          },
          "debtor_name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 70,
            "description": "Account holder name"
          },
          "authorization_date": {
            "type": "string",
            "format": "date",
            "description": "Date of mandate authorization"
          }
        }
      },
      "response": {
        "type": "object",
        "required": ["success", "mandate_reference"],
        "properties": {
          "success": { "type": "boolean" },
          "mandate_reference": {
            "type": "string",
            "pattern": "^SEPA-\\d{4}-\\d{2}-\\d{4}$"
          },
          "status": {
            "type": "string",
            "enum": ["Active", "Pending", "Suspended", "Cancelled"]
          },
          "message": { "type": "string" },
          "audit_log_id": { "type": "string" }
        }
      }
    },
    "validate_iban": {
      "request": {
        "type": "object",
        "required": ["iban"],
        "properties": {
          "iban": {
            "type": "string",
            "minLength": 15,
            "maxLength": 34
          },
          "country_code": {
            "type": "string",
            "pattern": "^[A-Z]{2}$"
          }
        }
      },
      "response": {
        "type": "object",
        "required": ["valid", "country", "bank_code"],
        "properties": {
          "valid": { "type": "boolean" },
          "country": { "type": "string" },
          "bank_code": { "type": "string" },
          "bank_name": { "type": "string" },
          "branch_code": { "type": "string" },
          "account_number": { "type": "string" },
          "check_digits": { "type": "string" },
          "formatted_iban": { "type": "string" },
          "error": { "type": "string" }
        }
      }
    },
    "revoke_mandate": {
      "request": {
        "type": "object",
        "required": ["mandate_reference", "reason"],
        "properties": {
          "mandate_reference": {
            "type": "string",
            "pattern": "^SEPA-\\d{4}-\\d{2}-\\d{4}$"
          },
          "reason": {
            "type": "string",
            "enum": ["customer_request", "invalid_account", "fraud_suspicion", "deceased", "other"]
          },
          "reason_details": {
            "type": "string",
            "maxLength": 500
          },
          "effective_date": {
            "type": "string",
            "format": "date"
          }
        }
      },
      "response": {
        "type": "object",
        "required": ["success", "status"],
        "properties": {
          "success": { "type": "boolean" },
          "status": { "type": "string" },
          "revocation_date": { 
            "type": "string",
            "format": "date-time"
          },
          "message": { "type": "string" },
          "audit_log_id": { "type": "string" }
        }
      }
    }
  },
  "direct_debit_apis": {
    "create_dd_batch": {
      "request": {
        "type": "object",
        "required": ["collection_date", "batch_type"],
        "properties": {
          "collection_date": {
            "type": "string",
            "format": "date",
            "description": "Target collection date (min D+2 for CORE)"
          },
          "batch_type": {
            "type": "string",
            "enum": ["FRST", "RCUR", "FNAL", "OOFF"],
            "description": "SEPA batch sequence type"
          },
          "invoice_filters": {
            "type": "object",
            "properties": {
              "membership_type": {
                "type": "array",
                "items": { "type": "string" }
              },
              "due_date_range": {
                "type": "object",
                "properties": {
                  "from": { "type": "string", "format": "date" },
                  "to": { "type": "string", "format": "date" }
                }
              },
              "max_amount": { 
                "type": "number",
                "minimum": 0.01,
                "maximum": 999999.99
              },
              "exclude_failed": { "type": "boolean" }
            }
          },
          "test_mode": { 
            "type": "boolean",
            "default": false
          }
        }
      },
      "response": {
        "type": "object",
        "required": ["success", "batch_id", "transaction_count", "total_amount"],
        "properties": {
          "success": { "type": "boolean" },
          "batch_id": {
            "type": "string",
            "pattern": "^DD-BATCH-\\d{8}-\\d{4}$"
          },
          "transaction_count": {
            "type": "integer",
            "minimum": 0
          },
          "total_amount": {
            "type": "number",
            "minimum": 0
          },
          "status": {
            "type": "string",
            "enum": ["Draft", "Submitted", "Processing", "Completed", "Failed", "Cancelled"]
          },
          "xml_file": { "type": "string" },
          "validation_errors": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "invoice": { "type": "string" },
                "error": { "type": "string" },
                "severity": {
                  "type": "string",
                  "enum": ["warning", "error"]
                }
              }
            }
          }
        }
      }
    },
    "process_dd_returns": {
      "request": {
        "type": "object",
        "required": ["batch_id", "return_file"],
        "properties": {
          "batch_id": {
            "type": "string",
            "pattern": "^DD-BATCH-\\d{8}-\\d{4}$"
          },
          "return_file": {
            "type": "string",
            "description": "Base64 encoded PAIN.002 return file"
          },
          "auto_retry": {
            "type": "boolean",
            "default": true
          }
        }
      },
      "response": {
        "type": "object",
        "required": ["success", "processed_count", "failed_count"],
        "properties": {
          "success": { "type": "boolean" },
          "processed_count": { "type": "integer" },
          "failed_count": { "type": "integer" },
          "retry_scheduled": { "type": "integer" },
          "failures": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "transaction_id": { "type": "string" },
                "reason_code": {
                  "type": "string",
                  "pattern": "^[A-Z]{2}[0-9]{2}$"
                },
                "reason_description": { "type": "string" },
                "amount": { "type": "number" },
                "retry_date": { 
                  "type": "string",
                  "format": "date"
                }
              }
            }
          }
        }
      }
    }
  },
  "payment_reconciliation_apis": {
    "import_bank_statement": {
      "request": {
        "type": "object",
        "required": ["bank_account", "statement_data"],
        "properties": {
          "bank_account": {
            "type": "string",
            "description": "GL Account for bank"
          },
          "statement_data": {
            "oneOf": [
              {
                "type": "string",
                "description": "Base64 encoded CAMT.053 file"
              },
              {
                "type": "object",
                "properties": {
                  "format": {
                    "type": "string",
                    "enum": ["MT940", "CAMT053", "CSV"]
                  },
                  "content": { "type": "string" }
                }
              }
            ]
          },
          "auto_reconcile": {
            "type": "boolean",
            "default": true
          },
          "reconciliation_rules": {
            "type": "object",
            "properties": {
              "match_threshold": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "default": 0.95
              },
              "date_tolerance_days": {
                "type": "integer",
                "minimum": 0,
                "maximum": 30,
                "default": 3
              }
            }
          }
        }
      },
      "response": {
        "type": "object",
        "required": ["success", "transactions_imported", "reconciliation_status"],
        "properties": {
          "success": { "type": "boolean" },
          "transactions_imported": { "type": "integer" },
          "reconciliation_status": {
            "type": "object",
            "properties": {
              "matched": { "type": "integer" },
              "unmatched": { "type": "integer" },
              "manual_review": { "type": "integer" }
            }
          },
          "bank_transactions": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "transaction_id": { "type": "string" },
                "date": { "type": "string", "format": "date" },
                "amount": { "type": "number" },
                "description": { "type": "string" },
                "reference": { "type": "string" },
                "matched_invoice": { "type": "string" },
                "confidence_score": { "type": "number" }
              }
            }
          }
        }
      }
    }
  }
}