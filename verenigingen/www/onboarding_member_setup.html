{% extends "templates/web.html" %}

{% block title %}
{{ _("Member Setup") }}
{% endblock %}

{% block page_content %}
<div class="container">
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <h1 class="text-center mb-5">{{ _("Get Started with Members") }}</h1>
            
            <div class="card mb-4">
                <div class="card-body">
                    <p class="lead text-center mb-4">
                        {{ _("Choose how you'd like to set up your first members:") }}
                    </p>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="fa fa-user-plus fa-3x mb-3 text-primary"></i>
                                    <h3>{{ _("Create Single Member") }}</h3>
                                    <p class="text-muted">
                                        {{ _("Manually create a member profile with all details") }}
                                    </p>
                                    <button class="btn btn-primary btn-lg" id="create-single-member">
                                        {{ _("Create Member") }}
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="fa fa-users fa-3x mb-3 text-success"></i>
                                    <h3>{{ _("Generate Test Members") }}</h3>
                                    <p class="text-muted">
                                        {{ _("Automatically create 7 sample members to explore the system") }}
                                    </p>
                                    {% if has_test_members %}
                                    <p class="text-warning small">
                                        <i class="fa fa-info-circle"></i> 
                                        {{ _("You already have {0} test members").format(test_members_count) }}
                                    </p>
                                    {% endif %}
                                    <button class="btn btn-success btn-lg" id="generate-test-members">
                                        {{ _("Generate Test Members") }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <a href="/app/module-onboarding/Verenigingen" class="btn btn-default">
                            {{ _("Back to Onboarding") }}
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="alert alert-info">
                <i class="fa fa-info-circle"></i>
                <strong>{{ _("Test Members") }}</strong>: 
                {{ _("Test members use @testvereniging.nl email addresses and can be easily identified and removed later.") }}
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // Create single member
    $('#create-single-member').click(function() {
        var btn = $(this);
        btn.prop('disabled', true).html('<i class="fa fa-spinner fa-spin"></i> ' + __('Redirecting...'));
        
        // Redirect to new member form
        window.location.href = '/app/member/new-member-1';
    });
    
    // Generate test members
    $('#generate-test-members').click(function() {
        var btn = $(this);
        btn.prop('disabled', true).html('<i class="fa fa-spinner fa-spin"></i> ' + __('Generating...'));
        
        frappe.call({
            method: 'verenigingen.www.onboarding_member_setup.generate_test_members_from_onboarding',
            callback: function(r) {
                if (r.message && r.message.success) {
                    // Show success message
                    frappe.show_alert({
                        message: r.message.message || __('Test members generated successfully!'),
                        indicator: 'green'
                    });
                    
                    // Redirect to member list after 2 seconds
                    setTimeout(function() {
                        window.location.href = '/app/member';
                    }, 2000);
                } else {
                    // Show error
                    frappe.show_alert({
                        message: r.message.error || __('Failed to generate test members'),
                        indicator: 'red'
                    });
                    btn.prop('disabled', false).html(__('Generate Test Members'));
                }
            },
            error: function() {
                frappe.show_alert({
                    message: __('An error occurred'),
                    indicator: 'red'
                });
                btn.prop('disabled', false).html(__('Generate Test Members'));
            }
        });
    });
});
</script>

<style>
.card {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.card h3 {
    margin-top: 10px;
    margin-bottom: 15px;
}

.card .btn {
    margin-top: 10px;
}

.card:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    transition: box-shadow 0.3s ease;
}
</style>
{% endblock %}