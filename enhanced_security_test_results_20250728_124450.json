{
  "timestamp": "2025-07-28T12:44:50.626995",
  "test_summary": {
    "overall_status": "GOOD",
    "overall_score": 75.0,
    "tests_passed": 4,
    "tests_partial": 1,
    "tests_failed": 1,
    "total_tests": 6
  },
  "detailed_results": {
    "decorator_validation": {
      "status": "PASS",
      "summary": "All 6 high-risk APIs have @critical_api decorators",
      "coverage_rate": 100.0,
      "details": {
        "apis_with_decorators": 6,
        "apis_without_decorators": 0,
        "operation_type_coverage": {
          "FINANCIAL": 4,
          "ADMIN": 1,
          "MEMBER_DATA": 1
        },
        "decorator_details": [
          {
            "api": "verenigingen/api/sepa_mandate_management.py::create_missing_sepa_mandates",
            "status": "HAS_DECORATOR",
            "operation_type": "FINANCIAL"
          },
          {
            "api": "verenigingen/api/sepa_mandate_management.py::fix_specific_member_sepa_mandate",
            "status": "HAS_DECORATOR",
            "operation_type": "FINANCIAL"
          },
          {
            "api": "verenigingen/api/payment_processing.py::send_overdue_payment_reminders",
            "status": "HAS_DECORATOR",
            "operation_type": "FINANCIAL"
          },
          {
            "api": "verenigingen/api/dd_batch_scheduler.py::toggle_auto_batch_creation",
            "status": "HAS_DECORATOR",
            "operation_type": "ADMIN"
          },
          {
            "api": "verenigingen/api/dd_batch_scheduler.py::run_batch_creation_now",
            "status": "HAS_DECORATOR",
            "operation_type": "FINANCIAL"
          },
          {
            "api": "verenigingen/api/member_management.py::assign_member_to_chapter",
            "status": "HAS_DECORATOR",
            "operation_type": "MEMBER_DATA"
          }
        ]
      }
    },
    "permission_boundaries": {
      "status": "PASS",
      "summary": "83.3% of APIs have explicit permission checks",
      "explicit_rate": 83.33333333333334,
      "details": {
        "apis_with_explicit_checks": 5,
        "apis_relying_on_framework": 1,
        "permission_patterns_found": {
          "frappe.has_permission": 3,
          "require_sepa_permission": 2,
          "PermissionError": 1
        },
        "details": [
          {
            "api": "verenigingen/api/sepa_mandate_management.py::create_missing_sepa_mandates",
            "status": "HAS_EXPLICIT_CHECKS",
            "patterns": [
              "frappe.has_permission"
            ]
          },
          {
            "api": "verenigingen/api/sepa_mandate_management.py::fix_specific_member_sepa_mandate",
            "status": "HAS_EXPLICIT_CHECKS",
            "patterns": [
              "frappe.has_permission"
            ]
          },
          {
            "api": "verenigingen/api/payment_processing.py::send_overdue_payment_reminders",
            "status": "FRAMEWORK_ONLY",
            "note": "Relies on @critical_api framework for permission checks"
          },
          {
            "api": "verenigingen/api/dd_batch_scheduler.py::toggle_auto_batch_creation",
            "status": "HAS_EXPLICIT_CHECKS",
            "patterns": [
              "require_sepa_permission"
            ]
          },
          {
            "api": "verenigingen/api/dd_batch_scheduler.py::run_batch_creation_now",
            "status": "HAS_EXPLICIT_CHECKS",
            "patterns": [
              "frappe.has_permission",
              "require_sepa_permission"
            ]
          },
          {
            "api": "verenigingen/api/member_management.py::assign_member_to_chapter",
            "status": "HAS_EXPLICIT_CHECKS",
            "patterns": [
              "PermissionError"
            ]
          }
        ]
      }
    },
    "input_validation_gaps": {
      "status": "PARTIAL",
      "summary": "66.7% have validation - 2 need enhancement",
      "validation_rate": 66.66666666666666,
      "details": {
        "apis_with_validation": 4,
        "apis_without_validation": 2,
        "validation_patterns": {
          "frappe.throw": 2,
          "validate_": 2,
          "ValidationError": 2,
          "validate_required_fields": 2,
          "APIValidator": 1
        },
        "details": [
          {
            "api": "verenigingen/api/sepa_mandate_management.py::create_missing_sepa_mandates",
            "status": "HAS_VALIDATION",
            "patterns": [
              "frappe.throw"
            ]
          },
          {
            "api": "verenigingen/api/sepa_mandate_management.py::fix_specific_member_sepa_mandate",
            "status": "HAS_VALIDATION",
            "patterns": [
              "frappe.throw"
            ]
          },
          {
            "api": "verenigingen/api/payment_processing.py::send_overdue_payment_reminders",
            "status": "HAS_VALIDATION",
            "patterns": [
              "validate_",
              "ValidationError",
              "validate_required_fields",
              "APIValidator"
            ]
          },
          {
            "api": "verenigingen/api/dd_batch_scheduler.py::toggle_auto_batch_creation",
            "status": "NEEDS_VALIDATION",
            "recommendation": "Add explicit input validation"
          },
          {
            "api": "verenigingen/api/dd_batch_scheduler.py::run_batch_creation_now",
            "status": "NEEDS_VALIDATION",
            "recommendation": "Add explicit input validation"
          },
          {
            "api": "verenigingen/api/member_management.py::assign_member_to_chapter",
            "status": "HAS_VALIDATION",
            "patterns": [
              "validate_",
              "ValidationError",
              "validate_required_fields"
            ]
          }
        ]
      }
    },
    "error_handling_robustness": {
      "status": "FAIL",
      "summary": "Only 66.7% have error handling - 2 APIs need improvement",
      "error_rate": 66.66666666666666,
      "details": {
        "apis_with_error_handling": 4,
        "apis_without_error_handling": 2,
        "error_patterns": {
          "try:": 3,
          "except": 3,
          "@handle_api_error": 2,
          "log_error": 2,
          "frappe.log_error": 1
        },
        "details": [
          {
            "api": "verenigingen/api/sepa_mandate_management.py::create_missing_sepa_mandates",
            "status": "HAS_ERROR_HANDLING",
            "patterns": [
              "try:",
              "except"
            ]
          },
          {
            "api": "verenigingen/api/sepa_mandate_management.py::fix_specific_member_sepa_mandate",
            "status": "NEEDS_ERROR_HANDLING",
            "recommendation": "Add try/catch and error logging"
          },
          {
            "api": "verenigingen/api/payment_processing.py::send_overdue_payment_reminders",
            "status": "HAS_ERROR_HANDLING",
            "patterns": [
              "try:",
              "except",
              "@handle_api_error",
              "log_error"
            ]
          },
          {
            "api": "verenigingen/api/dd_batch_scheduler.py::toggle_auto_batch_creation",
            "status": "NEEDS_ERROR_HANDLING",
            "recommendation": "Add try/catch and error logging"
          },
          {
            "api": "verenigingen/api/dd_batch_scheduler.py::run_batch_creation_now",
            "status": "HAS_ERROR_HANDLING",
            "patterns": [
              "try:",
              "except",
              "frappe.log_error",
              "log_error"
            ]
          },
          {
            "api": "verenigingen/api/member_management.py::assign_member_to_chapter",
            "status": "HAS_ERROR_HANDLING",
            "patterns": [
              "@handle_api_error"
            ]
          }
        ]
      }
    },
    "audit_logging_completeness": {
      "status": "PASS",
      "summary": "Audit framework available, 100.0% of APIs use explicit audit logging",
      "audit_rate": 100.0,
      "details": {
        "framework_available": true,
        "apis_using_audit": 6,
        "audit_patterns": {
          "frappe.log_error": 6
        },
        "details": [
          {
            "api": "verenigingen/api/sepa_mandate_management.py::create_missing_sepa_mandates",
            "status": "HAS_AUDIT_LOGGING",
            "patterns": [
              "frappe.log_error"
            ]
          },
          {
            "api": "verenigingen/api/sepa_mandate_management.py::fix_specific_member_sepa_mandate",
            "status": "HAS_AUDIT_LOGGING",
            "patterns": [
              "frappe.log_error"
            ]
          },
          {
            "api": "verenigingen/api/payment_processing.py::send_overdue_payment_reminders",
            "status": "HAS_AUDIT_LOGGING",
            "patterns": [
              "frappe.log_error"
            ]
          },
          {
            "api": "verenigingen/api/dd_batch_scheduler.py::toggle_auto_batch_creation",
            "status": "HAS_AUDIT_LOGGING",
            "patterns": [
              "frappe.log_error"
            ]
          },
          {
            "api": "verenigingen/api/dd_batch_scheduler.py::run_batch_creation_now",
            "status": "HAS_AUDIT_LOGGING",
            "patterns": [
              "frappe.log_error"
            ]
          },
          {
            "api": "verenigingen/api/member_management.py::assign_member_to_chapter",
            "status": "HAS_AUDIT_LOGGING",
            "patterns": [
              "frappe.log_error"
            ]
          }
        ]
      }
    },
    "security_framework_integration": {
      "status": "PASS",
      "summary": "100% of framework files present, good import usage",
      "framework_presence": 100.0,
      "details": {
        "framework_files_present": 4,
        "framework_files_missing": 0,
        "import_usage": {
          "api_security_framework": 6,
          "critical_api": 6,
          "OperationType": 6,
          "SecurityLevel": 2
        },
        "details": [
          {
            "file": "verenigingen/utils/security/api_security_framework.py",
            "status": "EXISTS"
          },
          {
            "file": "verenigingen/utils/security/authorization.py",
            "status": "EXISTS"
          },
          {
            "file": "verenigingen/utils/security/audit_logging.py",
            "status": "EXISTS"
          },
          {
            "file": "verenigingen/utils/security/enhanced_validation.py",
            "status": "EXISTS"
          },
          {
            "api_file": "verenigingen/api/sepa_mandate_management.py",
            "imports_found": [
              "api_security_framework",
              "critical_api",
              "OperationType"
            ]
          },
          {
            "api_file": "verenigingen/api/sepa_mandate_management.py",
            "imports_found": [
              "api_security_framework",
              "critical_api",
              "OperationType"
            ]
          },
          {
            "api_file": "verenigingen/api/payment_processing.py",
            "imports_found": [
              "api_security_framework",
              "critical_api",
              "OperationType",
              "SecurityLevel"
            ]
          },
          {
            "api_file": "verenigingen/api/dd_batch_scheduler.py",
            "imports_found": [
              "api_security_framework",
              "critical_api",
              "OperationType"
            ]
          },
          {
            "api_file": "verenigingen/api/dd_batch_scheduler.py",
            "imports_found": [
              "api_security_framework",
              "critical_api",
              "OperationType"
            ]
          },
          {
            "api_file": "verenigingen/api/member_management.py",
            "imports_found": [
              "api_security_framework",
              "critical_api",
              "OperationType",
              "SecurityLevel"
            ]
          }
        ]
      }
    }
  },
  "security_enhancements": [
    {
      "category": "Input Validation",
      "priority": "HIGH",
      "description": "Add input validation to 2 APIs",
      "apis": [
        "verenigingen/api/dd_batch_scheduler.py::toggle_auto_batch_creation",
        "verenigingen/api/dd_batch_scheduler.py::run_batch_creation_now"
      ],
      "implementation": "Add validate_required_fields() and validate_with_schema() calls"
    },
    {
      "category": "Error Handling",
      "priority": "MEDIUM",
      "description": "Enhance error handling in 2 APIs",
      "apis": [
        "verenigingen/api/sepa_mandate_management.py::fix_specific_member_sepa_mandate",
        "verenigingen/api/dd_batch_scheduler.py::toggle_auto_batch_creation"
      ],
      "implementation": "Add try/catch blocks and @handle_api_error decorators"
    }
  ],
  "recommendations": [
    "\ud83d\udfe1 Good security implementation. Address partial results for optimal security.",
    "\ud83d\udea8 HIGH PRIORITY: Address 1 critical security gaps",
    "\u26a0\ufe0f MEDIUM PRIORITY: Enhance 1 security areas",
    "\u26a0\ufe0f Address security gaps before production deployment"
  ]
}
